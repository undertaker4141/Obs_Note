# 有號數表示法

本節介紹有號整數的表示法，特別是 ARM 處理器中使用的 2's 補數表示法。

## 有號數概念

有號數 (Signed Number) 是可以表示正數、負數和零的數值。在電腦系統中，有號數通常使用固定位元數表示，如 8 位元、16 位元或 32 位元。

## 2's 補數表示法

ARM 處理器使用 2's 補數 (Two's Complement) 表示法來表示有號整數。在這種表示法中：

- 最高位 (Most Significant Bit, MSB) 作為符號位
  - 0 表示正數或零
  - 1 表示負數
  
- 正數直接用二進制表示
  - 例如：+5 表示為 `00000101` (8 位元)
  
- 負數使用 2's 補數表示：
  1. 取正數的二進制表示
  2. 所有位元取反 (1's 補數)
  3. 加 1
  
  例如：-5 的表示過程
  - +5 的二進制：`00000101`
  - 取反：`11111010`
  - 加 1：`11111011` (這就是 -5 的 2's 補數表示)

## 不同位元寬度的範圍

2's 補數表示法的數值範圍取決於位元寬度：

- **8 位元 (位元組)**：-128 ~ +127
  - 最小值：`10000000` (-128)
  - 最大值：`01111111` (+127)
  - 零：`00000000` (0)

- **16 位元 (半字)**：-32,768 ~ +32,767
  - 最小值：`1000 0000 0000 0000` (-32,768)
  - 最大值：`0111 1111 1111 1111` (+32,767)
  - 零：`0000 0000 0000 0000` (0)

- **32 位元 (字)**：-2,147,483,648 ~ +2,147,483,647
  - 最小值：`1000 0000 0000 0000 0000 0000 0000 0000` (-2^31)
  - 最大值：`0111 1111 1111 1111 1111 1111 1111 1111` (+2^31-1)
  - 零：`0000 0000 0000 0000 0000 0000 0000 0000` (0)

## 2's 補數的特性

### 1. 加法和減法統一

2's 補數的一個主要優點是可以使用相同的硬體電路執行加法和減法：

```
A - B = A + (-B)
```

其中 `-B` 是 B 的 2's 補數。

### 2. 零的唯一表示

2's 補數只有一種表示零的方式：所有位元都是 0。這避免了正零和負零的問題。

### 3. 對稱性

除了最小值外，2's 補數表示法中的正數和負數範圍是對稱的。例如，8 位元可以表示 -128 到 +127，其中 -128 沒有對應的正數。

### 4. 溢位特性

當兩個有號數相加時，可能會發生溢位：
- 兩個正數相加得到負數
- 兩個負數相加得到正數

## 正負數轉換

在 2's 補數表示法中，正數和負數之間的轉換非常簡單：

### 正數轉負數

1. 所有位元取反
2. 加 1

```assembly
; R0 包含正數，轉換為負數
MVN R0, R0      ; 所有位元取反 (1's 補數)
ADD R0, R0, #1  ; 加 1 得到 2's 補數
```

或者使用更簡潔的方法：

```assembly
NEG R0, R0      ; R0 = -R0 (部分 ARM 核心支援)
```

或者：

```assembly
RSB R0, R0, #0  ; R0 = 0 - R0
```

### 負數轉正數

1. 所有位元取反
2. 加 1

```assembly
; R0 包含負數，轉換為正數
MVN R0, R0      ; 所有位元取反
ADD R0, R0, #1  ; 加 1
```

這與正數轉負數的過程相同，因為 `-(-x) = x`。

## 有號數擴展

當需要將較小位元寬度的有號數擴展為較大位元寬度時，需要進行符號擴展 (Sign Extension)：

- 將原始數值的符號位複製到所有高位

例如，將 8 位元有號數 `10000101` (-123) 擴展為 16 位元：
- 結果為 `1111 1111 1000 0101`

這確保了擴展後的數值與原始數值在數學上相等。

## 有號數在 ARM 中的使用

ARM 處理器提供了多種指令來處理有號數：

- 有號數算術指令 (如 ADDS, SUBS)
- 有號數乘法指令 (如 SMULL)
- 有號數除法指令 (如 SDIV，在某些核心中支援)
- 算術右移指令 (ASR)
- 符號擴展載入指令 (LDRSB, LDRSH)
- 有號數比較指令和條件碼

這些將在後續章節中詳細介紹。

## 返回

- [[ARM有號整數運算|返回第五章目錄]]
- [[微處理機概述|返回微處理機概述]]
