# 進階檔案處理

(來源: c8_advanced_file_processing.pdf, c8_advanced_file_processing 1.pdf)

## 檔案壓縮

檔案壓縮可以減少檔案大小，節省儲存空間和傳輸時間。

- **無失真壓縮 (Lossless Compression)**：可以完全還原原始檔案，常用於文字檔案。
    
- **失真壓縮 (Lossy Compression)**：會丟失部分資訊以換取更高的壓縮率，常用於圖片 (如 JPEG)、音訊、視訊檔案。
    

### `compress` 和 `uncompress` (傳統，現較少預裝)

- `compress [option] file-list`: 使用 Lempel-Ziv 編碼壓縮檔案，產生 `.Z` 副檔名的壓縮檔，並移除原始檔。
    
    - `-v`: 顯示壓縮百分比。
        
    - `-c`: 將壓縮結果輸出到標準輸出，不產生 `.Z` 檔。
        
- `uncompress [option] file-list.Z`: 解壓縮 `.Z` 檔案，還原原始檔，並移除 `.Z` 檔。
    

### `gzip` (GNU zip) 和 `gunzip`

- `gzip [option] [file-list]`: 壓縮檔案，產生 `.gz` 副檔名的壓縮檔，並移除原始檔。
    
    - `-N` (N為1-9): 控制壓縮速度和壓縮率 (1 最快，9 壓縮率最高但最慢)。
        
    - `-c`: 將壓縮結果輸出到標準輸出。
        
    - `-d`: 解壓縮 (等同於 `gunzip`)。
        
    - `-f`: 強制壓縮。
        
    - `-l`: 列出壓縮檔案的相關資訊 (壓縮前後大小、壓縮率等)。
        
    - `-r`: 遞迴壓縮目錄中的檔案。
        
    - `-t`: 測試壓縮檔案的完整性。
        
    - `-v`: 顯示壓縮百分比和檔名。
        
- `gunzip [option] [file-list.gz]`: 解壓縮 `.gz` 檔案 (等同於 `gzip -d`)。
    

### `gzexe`

- `gzexe [options] [executable-file-list]`: 壓縮可執行檔，壓縮後的檔案仍然可以直接執行。會產生一個備份檔案 (檔名~)。
    
    - `-d`: 解壓縮。
        

### `zcat` 和 `zmore` (或 `gzcat`)

- `zcat [options] [compressed-file-list]`: 在不實際解壓縮檔案的情況下，將壓縮檔案 (`.Z` 或 `.gz`) 的內容輸出到標準輸出 (類似 `cat`)。
    
- `zmore [options] [compressed-file-list]`: 分頁顯示壓縮檔案的內容 (類似 `more`)。
    

## 排序檔案 (`sort`)

- `sort [options] [file-list]`: 對文字檔案的行進行排序。
    
- 預設行為：按字母順序 (ASCII) 排序整行。
    
- 常用選項：
    
    - `-b`: 忽略行首空白。
        
    - `-d`: 按字典順序排序 (只考慮字母、數字和空白)。
        
    - `-f`: 忽略大小寫。
        
    - `-n`: 按數值大小排序。
        
    - `-r`: 反向排序 (降序)。
        
    - `-u`: 移除重複行 (等同於 `sort file | uniq`)。
        
    - `-k field_definition`: 按指定的欄位排序。例如 `-k2` 按第二欄排序，`-k2,2n` 按第二欄的數值排序。
        
    - `-t char`: 指定欄位分隔符 (預設為空白)。
        
    - `+pos1 [-pos2]`: (舊式語法) 指定排序鍵，從 `pos1` 開始到 `pos2` (或行尾)。欄位編號從 0 開始。
        
    - `-o output-file`: 將排序結果儲存到 `output-file` 而非標準輸出。
        

## 搜尋指令和檔案

### `find`

- `find directory-list expression`: 在指定的目錄及其子目錄中遞迴搜尋符合條件的檔案。
    
- `expression` 由多個條件組成：
    
    - `-name pattern`: 按檔名搜尋 (可使用萬用字元，需引號包圍，如 `'*.txt'`)。
        
    - `-iname pattern`: 同 `-name`，但忽略大小寫。
        
    - `-type type_char`: 按檔案類型搜尋 (`f` 普通檔案, `d` 目錄, `l` 符號連結等)。
        
    - `-user username`: 按檔案擁有者搜尋。
        
    - `-group groupname`: 按檔案群組搜尋。
        
    - `-perm octal-mode`: 按權限搜尋 (如 `-perm 644`)。
        
    - `-size n[cwbkMG]`: 按檔案大小搜尋 (`n` 為單位數，`c` 位元組, `w` 字, `b` 區塊, `k` KB, `M` MB, `G` GB)。可使用 `+n` (大於n) 或 `-n` (小於n)。
        
    - `-mtime n`: 按修改時間搜尋 (n 天前)。`+n` (n天之前)，`-n` (n天之內)。
        
    - `-newer file`: 搜尋比 `file` 更新的檔案。
        
    - `-print`: (舊式，某些系統預設) 顯示找到的檔案路徑。
        
    - `-ls`: 以 `ls -dils` 格式顯示找到的檔案。
        
    - `-exec CMD {} \;`: 對每個找到的檔案執行指令 `CMD`，`{}` 代表找到的檔名。`\;` 必須。
        
    - `-ok CMD {} \;`: 同 `-exec`，但執行前會提示。
        
    - 條件可以用 `-a` (AND，預設)、`-o` (OR)、`!` (NOT) 和 `()` (分組，需跳脫 `\( \)` ) 組合。
        

### `whereis`

- `whereis [options] command-name-list`: 尋找指令的二進位檔、原始碼檔案和手冊頁位置。
    
- 常用選項：
    
    - `-b`: 只搜尋二進位檔。
        
    - `-m`: 只搜尋手冊頁。
        
    - `-s`: 只搜尋原始碼。
        

### `which`

- `which command-name-list`: 顯示當 shell 執行該指令時，會執行的指令的完整路徑。它會搜尋 `PATH` 環境變數中列出的目錄。
    

## 正規表示式 (Regular Expression)

正規表示式是用於描述字串模式的一種語法。許多 UNIX 工具支援正規表示式來進行文字搜尋和處理。

- 基本元字元：
    
    - `.`: 匹配任意單一字元 (除了換行符)。
        
    - `*`: 匹配前一個元素零次或多次。例如 `a*` 匹配 "" (空字串), "a", "aa" 等。
        
    - `^`: 匹配行的開頭。例如 `^abc` 匹配以 "abc" 開頭的行。
        
    - `$`: 匹配行的結尾。例如 `xyz$` 匹配以 "xyz" 結尾的行。
        
    - `[]`: 匹配方括號內的任意一個字元。例如 `[abc]` 匹配 "a" 或 "b" 或 "c"。可使用範圍，如 `[0-9]` 匹配任意數字，`[a-zA-Z]` 匹配任意字母。
        
    - `[^]`: 匹配不在方括號內的任意一個字元。例如 `[^0-9]` 匹配任意非數字字元。
        
    - `\`: 跳脫字元，用於匹配元字元的字面意義，例如 `\.` 匹配點號 "."。
        
- 擴充元字元 (egrep, awk 等支援)：
    
    - `+`: 匹配前一個元素一次或多次。例如 `a+` 匹配 "a", "aa" 等，但不匹配空字串。
        
    - `?`: 匹配前一個元素零次或一次。例如 `colou?r` 匹配 "color" 或 "colour"。
        
    - `|`: OR 運算子。例如 `cat|dog` 匹配 "cat" 或 "dog"。
        
    - `()`: 分組，將部分模式視為一個整體。例如 `(ab)+` 匹配 "ab", "abab" 等。
        
    - `{n}`: 匹配前一個元素恰好 n 次。
        
    - `{n,}`: 匹配前一個元素至少 n 次。
        
    - `{n,m}`: 匹配前一個元素至少 n 次，但不超過 m 次。
        
- **注意**：不同工具 (如 `grep`, `egrep`/`grep -E`, `sed`, `awk`, `vim`) 對正規表示式的支援程度和語法細節可能略有不同。
    

## 搜尋檔案內容

### `grep` (Global Regular Expression Print)

- `grep [options] pattern [file-list]`: 在檔案中搜尋包含指定模式 (pattern) 的行。
    
- `pattern` 可以是簡單字串或基本正規表示式。
    
- 常用選項：
    
    - `-i`: 忽略大小寫。
        
    - `-v`: 反向搜尋，顯示不包含模式的行。
        
    - `-n`: 顯示行號。
        
    - `-c`: 只顯示匹配的行數。
        
    - `-l`: 只顯示包含匹配行的檔名。
        
    - `-w`: 將模式視為一個完整的單字進行匹配。
        
    - `-r` 或 `-R`: 遞迴搜尋目錄。
        
    - `-E`: 使用擴充正規表示式 (等同於 `egrep`)。
        
    - `-F`: 將模式視為固定字串，不解釋為正規表示式 (等同於 `fgrep`)。
        

### `egrep` (Extended GREP)

- `egrep [options] pattern [file-list]` (通常等同於 `grep -E`)
    
- 支援擴充正規表示式，語法更靈活。
    

### `fgrep` (Fixed GREP)

- `fgrep [options] string [file-list]` (通常等同於 `grep -F`)
    
- 不將搜尋字串解釋為正規表示式，直接按字面意義搜尋，速度較快，適用於搜尋固定字串。
    

## 剪下和貼上 (欄位處理)

### `cut`

- `cut options [file-list]`: 從檔案的每一行中剪下選定的部分 (位元組、字元或欄位)。
    
- 常用選項：
    
    - `-b list`: 按位元組清單選取。
        
    - `-c list`: 按字元清單選取。
        
    - `-f list`: 按欄位清單選取。
        
    - `-d char`: 指定欄位分隔符 (預設為 TAB)。
        
    - `-s`: 只輸出包含分隔符的行 (與 `-f` 一起使用時)。
        
    - `list` 可以是單個數字、逗號分隔的數字列表 (如 `1,3,5`)、範圍 (如 `1-5`) 或混合 (如 `1,3-5,10`)。
        

### `paste`

- `paste [options] [file-list]`: 水平合併檔案的行。
    
- 常用選項：
    
    - `-d list`: 使用 `list` 中的字元作為分隔符，循環使用 (預設為 TAB)。
        
    - `-s`: 串列處理每個檔案，將每個檔案的所有行合併為一行。
        

## 編碼與解碼 (`uuencode`, `uudecode`)

- 傳統郵件系統僅能傳輸純文字，對某些字元敏感 (如行首的 `~`)。現代郵件客戶端使用 MIME 附件通常沒有此問題。
    
- `uuencode`：將二進位檔案轉換為可列印的 ASCII 字元，以便透過舊式郵件系統傳輸。
    
    - `uuencode [option] [source-file] decode_label > output-file`
        
    - `decode_label` 是解碼後原始檔案的名稱。
        
- `uudecode`：將 `uuencode` 編碼的檔案還原為原始二進位格式。
    
    - `uudecode [options] [encoded-file]`
        
    - 解碼後的檔案名由編碼檔案的頭部資訊決定 (即 `decode_label`)。
        
- 注意：`uuencode` 產生的檔案約比原始檔案大 38%。建議先壓縮再編碼。
    
- 現代系統通常使用 Base64 編碼 (MIME 的一部分) 達到類似目的。
    

## 檔案加密與解密 (`crypt`, `ccrypt`)

- 加密是將檔案轉換為與原始版本完全不同的形式；解密則是反向過程。
    
- `crypt` (傳統)：
    
    - `crypt key < original_file > encrypted_file`
        
    - `crypt key < encrypted_file > original_file`
        
    - 由於安全性太弱，現代 Linux 發行版通常不包含此指令。
        
- `ccrypt` (替代方案)：
    
    - 加密: `ccrypt -e -K 'key' < original_file > encrypted_file`
        
    - 解密: `ccrypt -d -K 'key' < encrypted_file > original_file`
        
    - 金鑰在加密和解密時必須相同。
        
- `crypt` 的安全性較低，不適用於高度機密文件。可考慮使用 `openssl` 工具獲取更高級別的安全性。
    

[[Unix學習筆記_總覽]]