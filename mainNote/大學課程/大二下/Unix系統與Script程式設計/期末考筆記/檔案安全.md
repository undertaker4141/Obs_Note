---
banner: 模板/banner.jpg
banner_y: "87"
---
# 檔案安全

(來源: c6_file_security.pdf)

## 檔案安全簡介

分時系統雖然帶來許多好處，但也帶來了保護硬體和軟體資源的主要挑戰。這些資源包括輸入/輸出 (I/O) 裝置、中央處理器 (CPU)、主記憶體以及儲存使用者檔案的輔助儲存裝置。本章節主要討論保護使用者檔案免於未經授權的存取。

UNIX 提供三種主要的檔案保護機制：

1. 登入名稱和密碼 (最基本的)。
    
2. 加密 (轉換檔案內容)。
    
3. 與檔案相關聯的存取權限。
    

## 1. 基於密碼的保護

- 每個 UNIX 使用者都有一個登入名稱 (公開的，位於 `/etc/passwd`) 和一個私密密碼。
    

## 2. 基於加密的保護

- 軟體工具可將檔案轉換為無法讀取的加密形式，並且可以反向解密。
    
- 即使發生未經授權的存取，也能保護重要檔案。
    
- 流程圖：原始檔案 -> 加密軟體 -> 加密檔案 -> 解密軟體 -> 原始檔案。
    
- `crypt` 指令曾用於此目的，但由於安全弱點 (DES) 已被棄用。`ccrypt` 可以透過特定選項提供類似的功能。
    

## 3. 基於存取權限的保護

- 防止使用者在未以檔案擁有者身份登入時存取不屬於他們的檔案。
    
- 檔案擁有者可以附加存取權限，規定誰可以存取以及允許哪些操作。
    
- 基於使用者類型、存取權限類型和允許的操作。
    
- 由於 UNIX 檔案系統對所有檔案都只有一個根目錄，因此這種保護機制至關重要。
    

### 使用者類型

- 使用者隸屬於群組，由系統管理員指派。群組資訊位於 `/etc/group`。
    
- 一個檔案的使用者可以是：
    
    - **擁有者 (user)**
        
    - **群組 (group)** (與檔案擁有者在同一群組的使用者)
        
    - **其他人 (others)** (其他所有擁有帳號的使用者)
        
- 檔案擁有者指定存取權限。
    
- 系統透過使用者 ID (UID) 而非登入名稱來識別使用者。
    
- **超級使用者 (系統管理員)**：登入名稱為 `root`，UID 為 `0`。無論權限如何，都可以存取所有檔案。`/etc/group` 列出所有系統群組。
    
    - 範例 `/etc/group` 項目：`bin::2:root,bin,daemon` (群組名稱、資訊、GID、成員)。
        
- 使用者的預設群組在 `/etc/passwd` 中設定。`groups` 指令顯示群組成員資格。
    

### 檔案操作/存取權限的類型

- 三種權限類型：
    
    - **讀取 (r)**：允許讀取檔案。
        
    - **寫入 (w)**：允許寫入或移除檔案。
        
    - **執行 (x)**：允許執行檔案 (適用於二進位檔或腳本)。
        
- 每種使用者類型 (擁有者、群組、其他人) 的權限可以是授予 (1) 或不授予 (0)。
    
- 每種使用者類型需要 3 個位元，因此有 8 (23) 種組合，以八進位 0-7 表示。
    
    - `0` (000)：無權限。
        
    - `1` (001)：僅執行。
        
    - `2` (010)：僅寫入。
        
    - `3` (011)：寫入和執行。
        
    - `4` (100)：唯讀。
        
    - `5` (101)：讀取和執行。
        
    - `6` (110)：讀取和寫入。
        
    - `7` (111)：讀取、寫入和執行 (所有權限)。
        
- 所有三種使用者類型 (擁有者、群組、其他人) 共需 9 個位元，形成一個 3 位數的八進位數字 (000-777)。
    
    - `ls -l` 輸出中：`0` 表示為 `-`，`1` 表示為 `r`、`w` 或 `x`。`---` 是八進位的 0，`rwx` 是八進位的 7。
        
    - 範例：`/etc/passwd` 的 `-rw-r--r--` 表示擁有者 (root) 具有讀寫權限，群組和其他人具有唯讀權限。
        

### 目錄的存取權限

- **讀取 (r)**：允許列出目錄內容 (例如，使用 `ls`)。
    
- **寫入 (w)**：允許在目錄內建立/刪除檔案/目錄。
    
- **執行 (x)**：搜尋/遍歷目錄的權限 (例如，`cd` 進入目錄，使用路徑存取其中的檔案)。
    
    - 沒有執行權限無法使用 `ls -l` 或 `cd`。
        
    - 對於路徑名稱中的任何元件都是如此。
        
- 沒有搜尋 (執行) 權限，目錄的讀取和寫入權限沒有意義。
    
    - 需要讀取 + 執行才能列出內容。
        
    - 需要寫入 + 執行才能在其中建立檔案。
        

### 確定檔案存取權限 (`ls -l`, `ls -ld`)

- `ls -l [file-list]`: 顯示長列表格式的檔案和/或目錄資訊。
    
    - 最左邊的字元表示檔案類型 (`d` 為目錄，`-` 為普通檔案)。
        
    - 接下來的九個字元顯示使用者、群組和其他人的檔案存取權限。
        
    - 第二個欄位是指向檔案的硬連結數量。
        
    - 第三個欄位顯示擁有者的登入名稱。
        
    - 第四個欄位顯示檔案的群組擁有者。
        
    - 第五個欄位顯示檔案大小 (以位元組為單位)。
        
    - 第六、七、八個欄位顯示檔案的建立 (或上次更新) 日期和時間。
        
    - 最後一個欄位是檔案名稱。
        
- `ls -ld [directory-list]`: 僅顯示目錄本身的長列表資訊，而不是其內容。
    

### 變更檔案存取權限 (`chmod`)

- `chmod [options] octal-mode file-list`
    
- `chmod [options] symbolic-mode file-list`
    
- **八進位模式 (Octal Mode)**：使用三位八進位數字 (例如 `755`, `644`) 設定權限。
    
    - 第一個數字代表擁有者，第二個代表群組，第三個代表其他人。
        
    - `7 (rwx)`, `6 (rw-)`, `5 (r-x)`, `4 (r--)`, `3 (-wx)`, `2 (-w-)`, `1 (--x)`, `0 (---)`
        
- **符號模式 (Symbolic Mode)**：格式為 `<who><operator><privilege>`。
    
    - `who`: `u` (使用者/擁有者), `g` (群組), `o` (其他人), `a` (所有人)。
        
    - `operator`: `+` (新增權限), `-` (移除權限), `=` (設定權限)。
        
    - `privilege`: `r` (讀取), `w` (寫入), `x` (執行/搜尋)。
        
- 常用選項：
    
    - `-R`: 遞迴地變更目錄及其子目錄下所有檔案的權限。
        
    - `-f`: 強制執行，不顯示錯誤訊息 (如果您是檔案擁有者)。
        

### 預設檔案存取權限 (`umask`)

- 新建立的檔案或目錄的預設權限由 `umask` 值決定。
    
- UNIX 系統中，新建立的可執行檔和目錄的預設權限通常是 `777`，文字檔案是 `666`。
    
- `umask` 是一個遮罩，用於從預設權限中移除某些權限。
    
- `umask` 指令：
    
    - `umask`: 顯示目前的遮罩值 (八進位)。
        
    - `umask -S`: 以符號形式顯示遮罩值。
        
    - `umask octal-mask`: 設定新的遮罩值。
        
- 實際權限計算：`實際權限 = 預設權限 AND (NOT umask值)`。
    
    - 範例：若 `umask` 為 `022` (二進位 `000 010 010`)，`NOT umask` 為 `755` (二進位 `111 101 101`)。
        
        - 新目錄權限 (`777` AND `755`) = `755` (`rwxr-xr-x`)。
            
        - 新文字檔案權限 (`666` AND `755`) = `644` (`rw-r--r--`)。
            

### 特殊存取位元

- 除了九個常用的存取權限位元外，還有三個具特殊意義的位元：
    
    - **Set-User-ID (SUID) 位元**:
        
        - 當設定於可執行檔時，該程式執行時會獲得檔案擁有者的權限，而非執行者的權限。
            
        - 常用於需要存取受保護資源的指令，如 `passwd` (擁有者為 root)。
            
        - `ls -l` 輸出中，擁有者的執行權限若為 `s` (小寫) 表示 SUID 和執行權限皆啟用；若為 `S` (大寫) 表示 SUID 啟用但執行權限未啟用。
            
        - `chmod 4xxx file-list` 或 `chmod u+s file-list` 設定 SUID。
            
    - **Set-Group-ID (SGID) 位元**:
        
        - 當設定於可執行檔時，程式執行時會獲得檔案群組擁有者的群組身份。
            
        - 當設定於目錄時，在該目錄下新建立的檔案和子目錄會繼承該目錄的群組擁有者。
            
        - `ls -l` 輸出中，群組的執行權限若為 `s` (小寫) 表示 SGID 和執行權限皆啟用；若為 `S` (大寫) 表示 SGID 啟用但執行權限未啟用。
            
        - `chmod 2xxx file-list` 或 `chmod g+s file-list` 設定 SGID。
            
    - **Sticky Bit (黏滯位元)**:
        
        - 主要用於共享目錄 (如 `/tmp`)，防止使用者刪除不屬於自己的檔案。
            
        - `ls -l` 輸出中，其他人的執行權限若為 `t` (小寫) 表示黏滯位元和執行權限皆啟用；若為 `T` (大寫) 表示黏滯位元啟用但執行權限未啟用。
            
        - `chmod 1xxx directory-list` 或 `chmod +t directory-list` 設定黏滯位元。
            
        - 歷史上用於指示核心將常用程式的程式碼保留在主記憶體或交換空間，但現代虛擬記憶體系統已使其不再必要。
            

[[Unix學習筆記_總覽]]