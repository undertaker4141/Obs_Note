# 基本定址模式

本節回顧 ARM 處理器中的基本定址模式，包括暫存器定址、立即定址和暫存器間接定址。

## 定址模式概述

定址模式 (Addressing Mode) 是指處理器用來計算操作數有效位址的方法。不同的定址模式提供了不同的靈活性和效率，適用於不同的程式設計需求。

## 暫存器定址 (Register Addressing)

暫存器定址是最基本的定址模式，操作數直接存放在暫存器中。

```assembly
ADD R0, R1, R2    ; R0 = R1 + R2
```

在這個例子中，操作數 R1 和 R2 都使用暫存器定址模式。

**特點**：
- 最快的定址模式
- 不需要記憶體存取
- 適用於頻繁使用的變數

## 立即定址 (Immediate Addressing)

立即定址是指操作數是指令本身包含的常數值。

```assembly
MOV R0, #42       ; R0 = 42
ADD R1, R2, #10   ; R1 = R2 + 10
```

在這些例子中，#42 和 #10 是立即數操作數。

**特點**：
- 快速，不需要額外的記憶體存取
- 立即數大小有限制 (在 ARM 中通常為 8 位元，可旋轉)
- 適用於常數值

### ARM 中的立即數限制

在 ARM Thumb 模式中，立即數通常有以下限制：
- 以 `#` 開頭
- 預設為十進制，使用 `0x` 前綴表示十六進制
- 通常限制為 8 位元大小 (0-255)，載入 32 位元暫存器時高位補零

對於無法直接表示的大立即數，可以使用 `LDR` 偽指令：

```assembly
LDR R0, =0x12345678    ; 載入大立即數
```

這是一個偽指令，組譯器會根據值的大小選擇：
- 如果值可以用 MOV 表示，則轉換為 MOV 指令
- 如果值太大，會將其儲存在文字池 (Literal Pool) 中，再用 PC 相對定址載入

## 暫存器間接定址 (Register Indirect Addressing)

暫存器間接定址是指操作數的位址存放在暫存器中。

```assembly
LDR R0, [R1]    ; R0 = Memory[R1]
STR R0, [R1]    ; Memory[R1] = R0
```

在這些例子中，R1 包含記憶體位址，方括號 `[ ]` 表示間接定址。

**特點**：
- 靈活，可以存取任意記憶體位置
- 需要一次記憶體存取
- 適用於陣列、指標等

## 基本定址模式的組合

基本定址模式可以組合使用，例如：

```assembly
ADD R0, R1, #10    ; 暫存器定址 + 立即定址
LDR R0, [R1, #4]   ; 暫存器間接定址 + 立即偏移
```

## 基本定址模式的應用

### 變數存取

```assembly
; 假設 R0 包含變數 x 的位址
LDR R1, [R0]       ; 載入 x 的值到 R1
ADD R1, R1, #1     ; R1 = R1 + 1
STR R1, [R0]       ; 儲存 R1 的值到 x
```

### 常數使用

```assembly
MOV R0, #0         ; 初始化 R0 為 0
MOV R1, #1         ; 設定 R1 為 1
ADD R0, R0, #10    ; R0 = R0 + 10
```

### 指標操作

```assembly
; 假設 R0 包含指標 p
LDR R1, [R0]       ; 載入 *p 到 R1
ADD R0, R0, #4     ; p++ (假設 4 位元組元素)
STR R1, [R0]       ; 儲存 R1 到 *p
```

## 基本定址模式的效率

不同定址模式的效率比較：

1. **暫存器定址**：最快，通常 1 個週期
2. **立即定址**：快，通常 1 個週期
3. **暫存器間接定址**：較慢，通常 2-3 個週期 (取決於記憶體存取速度)

## 基本定址模式的限制

基本定址模式有一些限制：

- **暫存器定址**：受限於暫存器數量 (ARM 有 16 個通用暫存器)
- **立即定址**：立即數大小有限制
- **暫存器間接定址**：需要預先計算和載入位址

這些限制促使 ARM 架構發展了更多進階的定址模式，如進階索引定址模式，將在下一節中介紹。

## 返回

- [[ARM定址模式|返回第六章目錄]]
- [[微處理機概述|返回微處理機概述]]
